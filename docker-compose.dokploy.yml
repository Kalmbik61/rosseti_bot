# ===============================================
# üöÄ Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Dokploy
# ===============================================
#
# –≠—Ç–∞ –≤–µ—Ä—Å–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤ Dokploy
# –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
#
version: '3.8'

services:
  # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å - Telegram –±–æ—Ç –ø–∞—Ä—Å–µ—Ä
  rosseti-parser:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: rosseti-parser-bot
    restart: unless-stopped
    
    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ Dokploy UI)
    environment:
      - NODE_ENV=production
      - TZ=Europe/Moscow
    
    # .env —Ñ–∞–π–ª –±—É–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω —á–µ—Ä–µ–∑ Dokploy Environment Variables
    # env_file:
    #   - .env
    
    # –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ volumes –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
    volumes:
      # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ - –ö–†–ò–¢–ò–ß–ù–û –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –¥–µ–ø–ª–æ—è–º–∏
      - rosseti_data:/app/data
      # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      - rosseti_logs:/app/logs
      # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
      - rosseti_reports:/app/reports
      # –ö–µ—à Playwright –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
      - playwright_cache:/home/botuser/.cache/ms-playwright
    
    # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ Dokploy UI)
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '0.5'
        reservations:
          memory: 256M
          cpus: '0.1'
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    healthcheck:
      test: ["CMD", "node", "-e", "console.log('Bot is running')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    
    # –ú–µ—Ç–∫–∏ –¥–ª—è Dokploy
    labels:
      - "dokploy.app=rosseti-parser"
      - "dokploy.service=bot"

# –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ volumes –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
volumes:
  # –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–±–∞–∑–∞ –ø–æ–¥–ø–∏—Å–æ–∫)
  rosseti_data:
    driver: local
    labels:
      - "dokploy.backup=true"
      - "dokploy.backup.schedule=daily"
  
  # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  rosseti_logs:
    driver: local
    labels:
      - "dokploy.backup=true"
      - "dokploy.backup.schedule=weekly"
  
  # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
  rosseti_reports:
    driver: local
    labels:
      - "dokploy.backup=true"
      - "dokploy.backup.schedule=weekly"
  
  # –ö–µ—à Playwright (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –±—ç–∫–∞–ø–∞)
  playwright_cache:
    driver: local

# –°–µ—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
networks:
  default:
    name: rosseti-parser-network
    labels:
      - "dokploy.app=rosseti-parser"

# ===============================================
# –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø –î–õ–Ø DOKPLOY:
# ===============================================
#
# 1. API —Å–µ—Ä–≤–∏—Å —É–±—Ä–∞–Ω - –≤ Dokploy –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å 
#    –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è API –µ—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è
#
# 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ 
#    Dokploy UI, –∞ –Ω–µ —á–µ—Ä–µ–∑ env_file
#
# 3. Volumes –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–º–∞ –≤–º–µ—Å—Ç–æ
#    bind mounts –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
#
# 4. –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–∫–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Dokploy
#    (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
#
# 5. –†–µ—Å—É—Ä—Å—ã –º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å 
#    —á–µ—Ä–µ–∑ Dokploy UI
#
# ===============================================
