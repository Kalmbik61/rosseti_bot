# üíæ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–∏—Å—Ç–µ–º–µ –±—ç–∫–∞–ø–æ–≤

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –±—ç–∫–∞–ø–æ–≤ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∏ –∏—Å—Ç–æ—Ä–∏–µ–π –æ—Ç–∫–ª—é—á–µ–Ω–∏–π —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Docker

```bash
# –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø (–¥–∞–Ω–Ω—ã–µ + –ª–æ–≥–∏ + –æ—Ç—á–µ—Ç—ã)
./docker/manage.sh backup

# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø —Ç–æ–ª—å–∫–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
./docker/manage.sh backup-db

# –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±—ç–∫–∞–ø–æ–≤
./docker/manage.sh backup-list

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
./docker/manage.sh backup-auto

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
./docker/manage.sh restore

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
./docker/manage.sh restore-db
```

### ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞

**–ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã:**

- `/admin_backup` - —Å–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `/admin_backup_list` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±—ç–∫–∞–ø–æ–≤
- `/admin_backup_restore` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞

## –¢–∏–ø—ã –±—ç–∫–∞–ø–æ–≤

### 1. üì¶ –ü–æ–ª–Ω—ã–π –±—ç–∫–∞–ø (`tar.gz`)

- **–°–æ–¥–µ—Ä–∂–∏—Ç:** `data/`, `logs/`, `reports/`
- **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `backups/rosseti-full-backup-YYYYMMDD-HHMMSS.tar.gz`
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### 2. üóÑÔ∏è –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`.db`)

- **–°–æ–¥–µ—Ä–∂–∏—Ç:** –¢–æ–ª—å–∫–æ —Ñ–∞–π–ª SQLite –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `data/backups/backup_YYYY-MM-DD_HH-MM-SS.db`
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ `manage.sh`

```bash
./docker/manage.sh backup-auto
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:**

1. –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00
2. –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
3. –ö–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤
4. –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 2:00)

### –†–æ—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤

- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** —Ö—Ä–∞–Ω–∏—Ç—Å—è 7 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–æ–≤ –ë–î
- **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞:** –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –±—ç–∫–∞–ø—ã —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –∫–∞–∂–¥—ã–π –±—ç–∫–∞–ø –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
parser_rosseti/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ subscriptions.db          # –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ backups/                  # –ë—ç–∫–∞–ø—ã –ë–î
‚îÇ       ‚îú‚îÄ‚îÄ backup_2024-01-15_03-00-00.db
‚îÇ       ‚îî‚îÄ‚îÄ backup_2024-01-16_03-00-00.db
‚îú‚îÄ‚îÄ backups/                      # –ü–æ–ª–Ω—ã–µ –±—ç–∫–∞–ø—ã
‚îÇ   ‚îú‚îÄ‚îÄ rosseti-full-backup-20240115-030000.tar.gz
‚îÇ   ‚îî‚îÄ‚îÄ rosseti-full-backup-20240116-030000.tar.gz
‚îî‚îÄ‚îÄ logs/
    ‚îî‚îÄ‚îÄ backup-cron.log          # –õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞

```typescript
import { backupManager } from "./utils/backup.js";

// –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
const backupPath = await backupManager.createBackup();
console.log("–ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω:", backupPath);

// –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ —Å –∏–º–µ–Ω–µ–º
const namedBackup = await backupManager.createBackup("manual-backup");
```

### –°–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –±—ç–∫–∞–ø–æ–≤
const backups = await backupManager.listBackups();

backups.forEach((backup) => {
  console.log(
    `${backup.filename} - ${backup.size} bytes - ${
      backup.isValid ? "OK" : "–ü–æ–≤—Ä–µ–∂–¥–µ–Ω"
    }`
  );
});
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

```typescript
// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
await backupManager.restoreFromBackup("/path/to/backup.db");
console.log("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞");
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º

```typescript
import { scheduler } from "./utils/scheduler.js";

// –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞ –≤ 3:00
scheduler.addBackupTask("0 3 * * *");
scheduler.startTask("auto-backup");

// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
const stats = scheduler.getStats();
console.log(`–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á: ${stats.activeTasks}`);
console.log(`–ü–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø: ${stats.lastBackup}`);
console.log(`–°–ª–µ–¥—É—é—â–∏–π –±—ç–∫–∞–ø: ${stats.nextBackup}`);
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
./docker/manage.sh backup-list

# –õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
tail -f logs/backup-cron.log

# –ü—Ä–æ–≤–µ—Ä–∫–∞ cron –∑–∞–¥–∞–Ω–∏–π
./docker/manage.sh backup-auto
# –í—ã–±–µ—Ä–∏—Ç–µ "5) –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cron"
```

### –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞

```
/admin_backup_list - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å–µ—Ö –±—ç–∫–∞–ø–∞—Ö
/admin_stats - –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
```

## –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è

### 1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
./docker/manage.sh stop

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î
./docker/manage.sh restore-db

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
./docker/manage.sh start
```

### 2. –ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
./docker/manage.sh stop

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
./docker/manage.sh restore

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
./docker/manage.sh start
```

### 3. –ß–µ—Ä–µ–∑ Telegram (—Ç–æ–ª—å–∫–æ –ë–î)

1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å `/admin_backup_restore`
2. –í—ã–±—Ä–∞—Ç—å –Ω—É–∂–Ω—ã–π –±—ç–∫–∞–ø –∏–∑ —Å–ø–∏—Å–∫–∞
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å:** –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–æ–≤
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
4. **–í–Ω–µ—à–Ω–∏–µ –∫–æ–ø–∏–∏:** —Ä–µ–≥—É–ª—è—Ä–Ω–æ –∫–æ–ø–∏—Ä—É–π—Ç–µ –±—ç–∫–∞–ø—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞

- –ö–æ–º–∞–Ω–¥—ã –±—ç–∫–∞–ø–∞ –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ `.env`)
- –§–∞–π–ª—ã –±—ç–∫–∞–ø–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (volume mount)
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ç–µ–∫—É—â–µ–π –ë–î

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ë—ç–∫–∞–ø –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫–∏
ls -la data/ data/backups/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
df -h

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
./docker/manage.sh logs
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron –∑–∞–¥–∞–Ω–∏—è
crontab -l | grep backup

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f logs/backup-cron.log

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
./docker/manage.sh backup-auto
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –±—ç–∫–∞–ø–∞
./docker/manage.sh backup-list

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Docker
./docker/manage.sh restore-db

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
./docker/manage.sh logs
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

### Webhook –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—ç–∫–∞–ø–∞

```typescript
// –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–¥ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞
const backupPath = await backupManager.createBackup();

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–æ –≤–Ω–µ—à–Ω—é—é —Å–∏—Å—Ç–µ–º—É
await fetch("https://your-webhook.com/backup-created", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    backup_path: backupPath,
    timestamp: new Date().toISOString(),
    size: await backupManager.getDatabaseSize(),
  }),
});
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –æ–±–ª–∞–∫–æ

```bash
# –ü—Ä–∏–º–µ—Ä –¥–ª—è AWS S3
aws s3 sync data/backups/ s3://your-bucket/rosseti-backups/

# –ü—Ä–∏–º–µ—Ä –¥–ª—è rsync
rsync -av data/backups/ user@backup-server:/backups/rosseti/
```
